name: Bot de Scrapping Quotidien

on:
  # Ex√©cution quotidienne √† 8h UTC (9h Paris en hiver, 10h en √©t√©)
  schedule:
    - cron: '0 8 * * *'  # Tous les jours √† 8h00 UTC = 9h00 Paris
  
  # Permet l'ex√©cution manuelle
  workflow_dispatch:

jobs:
  scraping:
    runs-on: ubuntu-latest
    
    steps:
    - name: üì• R√©cup√©ration du code
      uses: actions/checkout@v4
    
    - name: üê≥ Configuration Docker Buildx
      uses: docker/setup-buildx-action@v3
    
    - name: üîß Construction de l'image Docker
      run: |
        docker build -t scraper-bot .
    
    - name: üöÄ Ex√©cution du bot de scrapping complet
      run: |
        docker run --rm \
          -e AIRTABLE_API_KEY="${{ secrets.AIRTABLE_API_KEY }}" \
          -e AIRTABLE_BASE_ID="${{ secrets.AIRTABLE_BASE_ID }}" \
          -e AIRTABLE_TABLE_NAME="${{ secrets.AIRTABLE_TABLE_NAME }}" \
          -e AIRTABLE_VIEW_NAME="${{ secrets.AIRTABLE_VIEW_NAME }}" \
          -e OPENAI_API_KEY="${{ secrets.OPENAI_API_KEY }}" \
          -e OPENAI_ORG_ID="${{ secrets.OPENAI_ORG_ID }}" \
          -e MAX_COMPANIES=200 \
          --security-opt seccomp=unconfined \
          --shm-size=2g \
          scraper-bot python main.py
    
    - name: üìä Affichage des logs
      if: always()
      run: |
        echo "‚úÖ Ex√©cution termin√©e √† $(date)"
        echo "üîç Consultez les logs ci-dessus pour les d√©tails" 